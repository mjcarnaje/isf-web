{% set active_page = "user.application.applications" %}
{% extends "./_helpers/layout/user_layout.html" %}
{% from './_helpers/macros/adoption_status_badge.html' import status_badge %}
{% block title %}
  Application
{% endblock title %}
{% block content %}
  <div class="space-y-8">
    <div class="relative flex items-start gap-8 px-10 py-12 mx-auto bg-white border shadow-md rounded-3xl">
      <a href="{{ url_for('user.animals.view_animal', id=application.animal_id) }}">
        <img src="{{ get_image(application.animal_photo_url) }}"
             class="object-cover h-full ring ring-primary-500 ring-offset-2 w-36 rounded-xl aspect-square"
             height="auto"
             width="auto"
             alt="Image Background">
      </a>
      <div class="flex flex-col w-full gap-6">
        <h1 class="text-3xl font-bold">{{ application.animal_name }}</h1>
        <div class="grid w-full grid-cols-2">
          <div class="flex items-center gap-3 p-3">
            <div class="grid w-8 h-8 {{ 'bg-green-500' if application.animal_is_dewormed else 'bg-gray-500' }} rounded-full place-items-center ">
              <i class="text-lg text-white fa-solid fa-shield"></i>
            </div>
            <p class="font-bold text-gray-800">Dewormed</p>
          </div>
          <div class="flex items-center gap-3 p-3">
            <div class="grid w-8 h-8 {{ 'bg-blue-500' if application.animal_is_neutered else 'bg-gray-500' }} rounded-full place-items-center ">
              <i class="text-lg text-white fa-solid fa-cut"></i>
            </div>
            <p class="font-bold text-gray-800">Neutered</p>
          </div>
          <div class="flex items-center gap-3 p-3">
            <div class="grid w-8 h-8 {{ 'bg-purple-500' if application.animal_in_shelter else 'bg-gray-500' }} rounded-full place-items-center ">
              <i class="text-lg text-white fa-solid fa-home"></i>
            </div>
            <p class="font-bold text-gray-800">Shelter</p>
          </div>
          <div class="flex items-center gap-3 p-3">
            <div class="grid w-8 h-8 {{ 'bg-yellow-500' if application.animal_is_rescued else 'bg-gray-500' }} rounded-full place-items-center ">
              <i class="text-lg text-white fa-solid fa-life-ring"></i>
            </div>
            <p class="font-bold text-gray-800">Rescued</p>
          </div>
          <div class="flex items-center gap-3 p-3">
            <div class="grid w-8 h-8 {{ 'bg-red-500' if application.animal_is_adopted else 'bg-gray-500' }} rounded-full place-items-center ">
              <i class="text-lg text-white fa-solid fa-heart"></i>
            </div>
            <p class="font-bold text-gray-800">Adopted</p>
          </div>
          <div class="flex items-center gap-3 p-3">
            <div class="grid w-8 h-8 {{ 'bg-primary-500' if application.animal_for_adoption else 'bg-gray-500' }} rounded-full place-items-center ">
              <i class="text-lg text-white fa-solid fa-paw"></i>
            </div>
            <p class="font-bold text-gray-800">For Adoption</p>
          </div>
        </div>
        <div class="flex gap-8">
          <div class="flex items-center gap-2">
            {% if application.interview_preference == "Zoom" %}
              <svg xmlns="http://www.w3.org/2000/svg"
                   xmlns:xlink="http://www.w3.org/1999/xlink"
                   id="Art"
                   viewBox="0 0 100 100"
                   class="w-5 h-5">
                <defs><style>.cls-1{fill:url(#linear-gradient);}.cls-2{fill:#fff;}</style><linearGradient id="linear-gradient" x1="23.66604" y1="95.61176" x2="76.33396" y2="4.38824" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0845bf" /><stop offset=".6" stop-color="#0b5cff" /><stop offset="1" stop-color="#4f90ee" /></linearGradient></defs>
                <g id="icon_ZM_container">
                <path id="container" class="cls-1" d="m100,50c0,5.34685-.42982,10.58971-1.25089,15.7018-2.71817,16.92367-16.12379,30.3292-33.04747,33.0473-5.11224.82107-10.35514,1.2509-15.70164,1.2509s-10.5894-.42982-15.70164-1.2509c-16.92368-2.7181-30.3293-16.12363-33.04747-33.0473C.42982,60.58971,0,55.34685,0,50s.42982-10.58971,1.25089-15.7018C3.96907,17.37453,17.37469,3.969,34.29836,1.2509,39.4106.42982,44.6535,0,50,0s10.5894.42982,15.70164,1.2509c16.92368,2.7181,30.3293,16.12363,33.04747,33.0473.82107,5.11209,1.25089,10.35496,1.25089,15.7018Z" />
                <path id="logo_ZM_wordmark" class="cls-2" d="m29.86217,57.65696h-12.40324c-.87023,0-1.64774-.51954-1.98075-1.32352s-.15056-1.72117.4648-2.33642l8.59125-8.59121h-6.15751c-1.69153,0-3.06279-1.37125-3.06279-3.06279h11.4385c.87016,0,1.64763.51939,1.98068,1.32337.33309.80398.15075,1.72102-.46454,2.33657l-8.59128,8.59121h7.1221c1.69153,0,3.06279,1.37125,3.06279,3.06279Zm54.8239-9.57121c0-3.29324-2.67923-5.97244-5.97244-5.97244-1.76155,0-3.34693.76704-4.44104,1.98416-1.09411-1.21711-2.67949-1.98416-4.44104-1.98416-3.29321,0-5.97244,2.67919-5.97244,5.97244v9.57121c1.69153,0,3.06279-1.37126,3.06279-3.06278v-6.50843c0-1.60437,1.30527-2.90965,2.90965-2.90965s2.90965,1.30527,2.90965,2.90965v6.50843c0,1.69153,1.37126,3.06278,3.06279,3.06278v-9.57121c0-1.60437,1.30527-2.90965,2.90965-2.90965s2.90965,1.30527,2.90965,2.90965v6.50843c0,1.69153,1.37126,3.06278,3.06278,3.06278v-9.57121Zm-22.35835,1.91424c0,4.3557-3.53098,7.88668-7.88668,7.88668s-7.88668-3.53098-7.88668-7.88668,3.53099-7.88668,7.88668-7.88668,7.88668,3.53098,7.88668,7.88668Zm-3.06279,0c0-2.66416-2.15973-4.82389-4.82389-4.82389s-4.82389,2.15973-4.82389,4.82389,2.15973,4.82389,4.82389,4.82389,4.82389-2.15973,4.82389-4.82389Zm-13.93568,0c0,4.3557-3.53098,7.88668-7.88668,7.88668s-7.88668-3.53098-7.88668-7.88668,3.53099-7.88668,7.88668-7.88668,7.88668,3.53098,7.88668,7.88668Zm-3.06279,0c0-2.66416-2.15973-4.82389-4.82389-4.82389s-4.82389,2.15973-4.82389,4.82389,2.15973,4.82389,4.82389,4.82389,4.82389-2.15973,4.82389-4.82389Z" />
                </g>
              </svg>
            {% endif %}
            {% if application.interview_preference == "Google Meet" %}
              <svg xmlns="http://www.w3.org/2000/svg"
                   fill="none"
                   width="800"
                   height="800"
                   viewBox="-13.1265 -18 113.763 108"
                   class="w-5 h-5">
                <path fill="#00832d" d="M49.5 36l8.53 9.75 11.47 7.33 2-17.02-2-16.64-11.69 6.44z" />
                <path fill="#0066da" d="M0 51.5V66c0 3.315 2.685 6 6 6h14.5l3-10.96-3-9.54-9.95-3z" />
                <path fill="#e94235" d="M20.5 0L0 20.5l10.55 3 9.95-3 2.95-9.41z" />
                <path fill="#2684fc" d="M20.5 20.5H0v31h20.5z" />
                <path fill="#00ac47" d="M82.6 8.68L69.5 19.42v33.66l13.16 10.79c1.97 1.54 4.85.135 4.85-2.37V11c0-2.535-2.945-3.925-4.91-2.32zM49.5 36v15.5h-29V72h43c3.315 0 6-2.685 6-6V53.08z" />
                <path fill="#ffba00" d="M63.5 0h-43v20.5h29V36l20-16.57V6c0-3.315-2.685-6-6-6z" />
              </svg>
            {% endif %}
            {% if application.interview_preference == "Phone" %}
              <div class="flex items-center justify-center w-5 h-5">
                <i class="text-gray-600 fa-solid fa-phone"></i>
              </div>
            {% endif %}
            <p class="font-medium text-gray-800">{{ application.interview_preference }}</p>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex items-center justify-center w-5 h-5">
              <i class="text-gray-600 fa-solid fa-calendar"></i>
            </div>
            <p class="font-medium text-gray-800">{{ application.interview_preferred_date.strftime("%b %d, %Y") }}</p>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex items-center justify-center w-5 h-5">
              <i class="text-gray-600 fa-solid fa-clock"></i>
            </div>
            <p class="font-medium text-gray-800">{{ application.interview_preferred_time }}</p>
          </div>
        </div>
        <div>
          <button class="text-sm text-right text-gray-500">{{ status_badge(application.current_status) }}</button>
        </div>
      </div>
    </div>
    <div class="space-y-4">
      <h2 class="text-xl font-bold">Status History</h2>
      <div class="flex flex-col gap-3">
        {% for history_item in status_history %}
          <div class="flex flex-col gap-3 p-4 bg-white shadow-md rounded-xl">
            <div class="flex justify-between">
              <div class="flex">
                {% if history_item.status == 'Pending' %}
                  <div class="flex items-center justify-center px-3 py-1 text-sm font-semibold text-gray-700 border border-gray-200 rounded-lg bg-gray-50">
                    Pending
                  </div>
                {% elif history_item.status == 'Interview' %}
                  <div class="flex items-center justify-center px-3 py-1 text-sm font-semibold text-white rounded-lg bg-primary-600">
                    To Be Interview
                  </div>
                {% elif history_item.status == 'Approved' %}
                  <div class="flex items-center justify-center px-3 py-1 text-sm font-semibold text-white rounded-lg bg-lime-500">
                    Approved
                  </div>
                {% elif history_item.status == 'Turnovered' %}
                  <div class="flex items-center justify-center px-3 py-1 text-sm font-semibold text-white bg-green-500 rounded-lg">
                    Turnovered
                  </div>
                {% elif history_item.status == 'Rejected' %}
                  <div class="flex items-center justify-center px-3 py-1 text-sm font-semibold text-white bg-red-500 rounded-lg">
                    Rejected
                  </div>
                {% else %}
                  <div class="badge">Unknown Status</div>
                {% endif %}
              </div>
              <p>{{ history_item.created_at | pretty_date }}</p>
            </div>
            <p class="italic">{{ history_item.remarks or "No remarks." }}</p>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endblock content %}
