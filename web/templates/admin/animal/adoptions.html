{% set active_page = "admin.animals.for_adoptionanimals" %}
{% extends "./_helpers/layout/admin_layout.html" %}
{% block title %}
  For Adoption Animals
{% endblock title %}
{% block content %}
  <div class="w-full mx-auto space-y-8">
    <h1 class="text-2xl font-bold">For Adoption Animals</h1>
    <dialog id="deleteModal" class="z-20 modal">
      <div class="bg-white modal-box">
        <h3 class="text-lg font-bold">Delete Animal</h3>
        <p class="py-4">Are you sure you want to delete this animal?</p>
        <div class="modal-action">
          <form method="dialog">
            <button class="btn">Cancel</button>
          </form>
          <button id="deleteAnyway" class="text-white btn btn-error">Delete Anyway</button>
        </div>
      </div>
    </dialog>
    <div class="grid w-full grid-cols-3 gap-8 mx-auto">
      {% for animal in animals %}
        <div class="flex flex-col bg-white border cursor-pointer group rounded-xl hover:shadow-sm">
          <a href="{{ url_for('admin.animals.adoption', id=animal.id) }}">
            <div class="h-full overflow-hidden border-b aspect-square rounded-t-xl">
              <img class="object-cover h-full transition-all duration-300 group-hover:scale-105"
                   src="{{ get_image(animal.photo_url) }}"
                   alt="Animal Photo"
                   width="auto"
                   height="auto" />
            </div>
          </a>
          <div class="flex-1 py-2 px-3 space-y-0.5">
            <a href="{{ url_for('admin.animals.adoption', id=animal.id) }}"
               class="text-xl font-bold text-primary-800">{{ animal.name }}</a>
            <div class="flex items-center gap-3">
              <p class="text-sm">Active Application:</p>
              <span class="text-white badge badge-info">{{ animal.user_count }}</span>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  <script>
    const deleteButtons = document.querySelectorAll(".open-delete-modal");
    deleteButtons.forEach((deleteButton) => {
      deleteButton.addEventListener("click", function () {
        deleteModal.showModal();
        const deleteAnyway = document.querySelector("#deleteAnyway");
        deleteAnyway.addEventListener("click", async function () {
          await fetch(`/admin.animals.${deleteButton.dataset.animalId}/delete`, {
            method: "DELETE",
            headers: {
              "X-CSRFToken": document.querySelector("meta[name='csrf_token']").content,
            },
          });
          window.location.reload();
        });
      });
    });
  </script>
{% endblock content %}
